#!/bin/bash
# acesso mysql
# mysql -u u109863032_edum -pedumaisedum
# backup de banco de dados
# mysqldump -u u109863032_edum -pedumaisedum u109863032_edum | gzip -9 > backup_edum.sql.gz 

# restaurar banco de dados
# mysql -u u109863032_edum -pedumaisedum -D nome_do_banco < backup_edum.sql
# mysql -u u109863032_tst -pu109863032_tst -D u109863032_tst < views_backup_edum.sql

# acesso github sem senha
# ssh-keygen -t rsa -b 4096 -C "7miguelsilva7@gmail.com"
# ssh-add ~/.ssh/id_rsa
# Adicionar chave ao github usando configurações de usuário no git
# git remote set-url origin git@github.com:7miguelsilva7/edumais.git

# acesso ssh servidor Edumais
# ssh -t u109863032@153.92.6.22 -p 65002
# acesso remoto sem senha
# gera chave no servidor local, apenas se não existir

        # ssh-keygen -t rsa
# copia chave para servidor online
        # ssh-copy-id u109863032@153.92.6.22 -p 65002

# arrays
# servidor Principal - Edumais
# urlServer='public_html'
# data_base='u109863032_edum'
# user_database='u109863032_edum'
# password_database='edumaisedum'
# datarootwww='http\:\/\/edumais.com.br\/moodle'
# dataRootmoodledata='edumais.com.br\/public_html'

# update git
git pull
git add --all

date=`date +%Y-%m-%d`

git commit -m "updated $date"
git push

ssh -t u109863032@153.92.6.22 -p 65002 "
cd edumais && 
bash resetGit &&
cp -u copy_img.php ../public_html/ &&
cp -u copy_img.html ../public_html/ &&
cp -ru img/ ../public_html/
"

# servidor Juazeiro Bahia
array='public_html/juazeiro-ba' 	#urlServer
array2='u109863032_juazeiro_ba'		#data_base
array3='u109863032_juazeiro_ba'		#user_database
array4='edumaisjuazeiro_ba'			#password_database
array5='http\:\/\/juazeiro-ba.edumais.com.br\/moodle'	#datarootwww
array6='\/home\/u109863032\/domains\/edumais.com.br\/public_html\/juazeiro-ba'	#dataRootmoodledata
array7='juazeiro-ba'	#logoSite e urlApp

for index in ${!array[*]}; 
do
	ssh -t u109863032@153.92.6.22 -p 65002 "rsync -ruvz --progress --exclude={'.git','omr'} edumais ${array[$index]} && rsync -ruvz --progress edumais/default.php ${array[$index]}
	
	mv ${array[$index]}/edumais/.env.modelo ${array[$index]}/edumais/.env &&
	sed -i 's/data_base/${array2[$index]}/g' ${array[$index]}/edumais/.env &&
	sed -i 's/user_database/${array3[$index]}/g' ${array[$index]}/edumais/.env &&
	sed -i 's/password_database/${array4[$index]}/g' ${array[$index]}/edumais/.env &&
	sed -i 's/edumaisAppURL/${array7[$index]}/g' ${array[$index]}/edumais/.env &&

	mv ${array[$index]}/edumais/connect.modelo.php ${array[$index]}/edumais/connect.php &&
	sed -i 's/data_base/${array2[$index]}/g' ${array[$index]}/edumais/connect.php &&
	sed -i 's/user_database/${array3[$index]}/g' ${array[$index]}/edumais/connect.php &&
	sed -i 's/password_database/${array4[$index]}/g' ${array[$index]}/edumais/connect.php &&

	sed -i 's/logoSite/${array7[$index]}/g' ${array[$index]}/default.php &&

	mv ${array[$index]}/moodle/config.modelo.php ${array[$index]}/moodle/config.php &&
	sed -i 's/data_base/${array2[$index]}/g' ${array[$index]}/moodle/config.php &&
	sed -i 's/user_database/${array3[$index]}/g' ${array[$index]}/moodle/config.php &&
	sed -i 's/password_database/${array4[$index]}/g' ${array[$index]}/moodle/config.php &&
	sed -i 's/datarootwww/${array5[$index]}/g' ${array[$index]}/moodle/config.php &&
	sed -i 's/dataRootmoodledata/${array6[$index]}/g' ${array[$index]}/moodle/config.php	
"
done